#include <game.h>

uint32_t w, h;
uint8_t isLeft = 0;
uint32_t mario_r[] = {
        0, 0, 0,        0,        0,        0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0,        0,        0,        0,        0, 0,
        0, 0, 0,        0,        0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0,        0, 0,
        0, 0, 0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0,        0,        0,        0, 0,
        0, 0, 0,        0x6a6b04, 0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0,        0, 0,
        0, 0, 0,        0x6a6b04, 0xe39d25, 0x6a6b04, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0,        0,        0,        0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0,        0,        0, 0,
        0, 0, 0,        0,        0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0,        0,        0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0x6a6b04, 0xb13425, 0xe39d25, 0xb13425, 0xb13425, 0xe39d25, 0xb13425, 0x6a6b04, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0xe39d25, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xe39d25, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0,        0,        0xb13425, 0xb13425, 0xb13425, 0,        0,        0xb13425, 0xb13425, 0xb13425, 0,        0,        0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0, 0,
};

uint32_t mario_l[] = {
        0, 0, 0,        0,        0,        0,        0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0,        0,        0,        0, 0,
        0, 0, 0,        0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0,        0,        0, 0,
        0, 0, 0,        0,        0,        0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0, 0,
        0, 0, 0,        0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0x6a6b04, 0,        0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0x6a6b04, 0xe39d25, 0x6a6b04, 0,        0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0,        0,        0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0xe39d25, 0,        0,        0,        0, 0,
        0, 0, 0,        0,        0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0,        0,        0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0xb13425, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0x6a6b04, 0xb13425, 0xe39d25, 0xb13425, 0xb13425, 0xe39d25, 0xb13425, 0x6a6b04, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0xe39d25, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xe39d25, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0xe39d25, 0xe39d25, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xb13425, 0xe39d25, 0xe39d25, 0, 0,
        0, 0, 0,        0,        0xb13425, 0xb13425, 0xb13425, 0,        0,        0xb13425, 0xb13425, 0xb13425, 0,        0,        0, 0,
        0, 0, 0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0, 0,
        0, 0, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0,        0,        0,        0,        0x6a6b04, 0x6a6b04, 0x6a6b04, 0x6a6b04, 0, 0
};



void init_video() {
    w = screen_width();
    h = screen_height();
}

void clear_video() {
    uint32_t pixels[1]; // careful! stack is limited!
    pixels[0] = BACKGROUND;
    _DEV_VIDEO_FBCTRL_t event = {
            .x = 0, .y = 0, .w = w, .h = h, .sync = 1,
            .pixels = pixels,
    };
    _io_write(_DEV_VIDEO, _DEVREG_VIDEO_FBCTRL, &event, sizeof(event));
}

void draw_mario() {
    if(isLeft) {
        _DEV_VIDEO_FBCTRL_t event = {
                .x = x, .y = y, .w = MARIO_WIDTH, .h = MARIO_HEIGHT, .sync = 1,
                .pixels = mario_l,
        };
        _io_write(_DEV_VIDEO, _DEVREG_VIDEO_FBCTRL, &event, sizeof(event));
    } else {
        _DEV_VIDEO_FBCTRL_t event = {
                .x = x, .y = y, .w = MARIO_WIDTH, .h = MARIO_HEIGHT, .sync = 1,
                .pixels = mario_r,
        };
        _io_write(_DEV_VIDEO, _DEVREG_VIDEO_FBCTRL, &event, sizeof(event));
    }
}
